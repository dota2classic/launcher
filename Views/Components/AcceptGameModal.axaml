<UserControl xmlns="https://github.com/avaloniaui"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:vm="using:d2c_launcher.ViewModels"
            xmlns:m="using:d2c_launcher.Models"
            xmlns:util="using:d2c_launcher.Util"
            x:Class="d2c_launcher.Views.Components.AcceptGameModal"
            x:DataType="vm:RoomViewModel">
   <UserControl.Resources>
       <util:NullToBoolConverter x:Key="NullToBoolConverter"/>
       <util:NullToInverseBoolConverter x:Key="NullToInverseBoolConverter"/>
       <util:InverseBoolConverter x:Key="InverseBoolConverter"/>
   </UserControl.Resources>

   <Panel IsVisible="{Binding IsAcceptGameModalOpen}" ZIndex="200"
          HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="#90000000">
       <Border HorizontalAlignment="Center" VerticalAlignment="Center"
               Padding="24" CornerRadius="12"
               Background="#121315" BorderBrush="#2d3842" BorderThickness="1"
               BoxShadow="0 12 28 0 #80000000">
           <StackPanel Spacing="16" MaxWidth="580">
               <StackPanel Spacing="4" HorizontalAlignment="Center">
                   <TextBlock Text="Игра найдена!" FontSize="20" FontWeight="Bold"
                              HorizontalAlignment="Center" Foreground="#D9D9D9"/>
                   <TextBlock Text="{Binding RoomModeText}" HorizontalAlignment="Center"
                              Foreground="#AAAAAA" FontSize="13"/>
               </StackPanel>

               <ItemsControl ItemsSource="{Binding RoomPlayers}">
                   <ItemsControl.ItemsPanel>
                       <ItemsPanelTemplate>
                           <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal"/>
                       </ItemsPanelTemplate>
                   </ItemsControl.ItemsPanel>
                   <ItemsControl.ItemTemplate>
                       <DataTemplate x:DataType="m:RoomPlayerView">
                           <StackPanel Spacing="4" Margin="8,6" Width="74" HorizontalAlignment="Center">
                               <Panel Width="58" Height="58" HorizontalAlignment="Center">
                                   <Ellipse Width="58" Height="58"
                                            Stroke="{Binding StateColor}" StrokeThickness="3"
                                            Fill="Transparent"/>
                                   <Border Width="52" Height="52" CornerRadius="26" ClipToBounds="True"
                                           Background="#242c34"
                                           HorizontalAlignment="Center" VerticalAlignment="Center">
                                       <Grid>
                                           <Image Source="{Binding AvatarImage}" Stretch="UniformToFill"
                                                  IsVisible="{Binding AvatarImage, Converter={StaticResource NullToBoolConverter}}"/>
                                           <TextBlock Text="{Binding Initials}"
                                                      IsVisible="{Binding AvatarImage, Converter={StaticResource NullToInverseBoolConverter}}"
                                                      HorizontalAlignment="Center" VerticalAlignment="Center"
                                                      FontSize="18" FontWeight="SemiBold" Foreground="#D9D9D9"/>
                                       </Grid>
                                   </Border>
                               </Panel>
                               <TextBlock Text="{Binding Name}" HorizontalAlignment="Center"
                                          FontSize="11" TextTrimming="CharacterEllipsis" MaxWidth="74"
                                          TextAlignment="Center" Foreground="#D9D9D9"/>
                               <TextBlock Text="{Binding StateText}" HorizontalAlignment="Center"
                                          Foreground="{Binding StateColor}" FontSize="10"
                                          TextAlignment="Center"/>
                           </StackPanel>
                       </DataTemplate>
                   </ItemsControl.ItemTemplate>
               </ItemsControl>

               <!-- Server searching state -->
               <TextBlock Text="Идёт поиск игрового сервера..." HorizontalAlignment="Center"
                          Foreground="#AAAAAA" FontSize="13"
                          IsVisible="{Binding IsServerSearchingModalOpen}"/>

               <!-- Accept/decline state (hidden while searching) -->
               <StackPanel IsVisible="{Binding IsServerSearchingModalOpen, Converter={StaticResource InverseBoolConverter}}">
                   <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12"
                               IsVisible="{Binding HasMyPlayerResponded, Converter={StaticResource InverseBoolConverter}}">
                       <Button Content="Принять" Command="{Binding AcceptGameCommand}"
                               Foreground="White" FontWeight="Bold" Padding="28,10"
                               CornerRadius="8" BorderThickness="0">
                           <Button.Background>
                               <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                   <GradientStop Color="#1a5aaa" Offset="0"/>
                                   <GradientStop Color="#3a90d6" Offset="1"/>
                               </LinearGradientBrush>
                           </Button.Background>
                       </Button>
                       <Button Content="Отклонить" Command="{Binding DeclineGameCommand}"
                               Background="#1a0f0f" Foreground="#C62626" FontWeight="Bold"
                               Padding="28,10" CornerRadius="8" BorderBrush="#C62626" BorderThickness="1"/>
                   </StackPanel>

                   <TextBlock Text="Ожидание других игроков..." HorizontalAlignment="Center"
                              Foreground="#AAAAAA" FontSize="13"
                              IsVisible="{Binding HasMyPlayerAccepted}"/>
               </StackPanel>
           </StackPanel>
       </Border>
   </Panel>
</UserControl>
